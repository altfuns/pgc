DROP TABLE EMPLEADO_PERMISOS;
DROP TABLE ROL_PERMISOS;
DROP TABLE PERMISO;
DROP TABLE NOTA;
DROP TABLE CORRESPONDENCIA_EXTERNA;
DROP TABLE TARIFA;
DROP TABLE TIPO_ENVIO;
DROP TABLE PAIS;
DROP TABLE GRUPO_ENVIO;
DROP TABLE CORRESPONDENCIA_INTERNA;
DROP TABLE TIPO_INTERNO;
DROP TABLE UNIDAD;
DROP TABLE RUTA;
DROP TABLE EMPLEADO;
DROP TABLE ROL;
DROP TABLE MOVIMIENTO_PRESUPUESTO;
DROP TABLE FACTURA;
DROP TABLE PRESUPUESTO;
DROP TABLE ERROR_LOG;
DROP TABLE TRANSACTION_LOG;

CREATE TABLE PERMISO(
	CODIGO VARCHAR(10),
	DIRECCION VARCHAR(75),
	DESCRIPCION VARCHAR(150),
	MODULO varchar(15),
	CONSTRAINT PK_PERMISO PRIMARY KEY (CODIGO)
);

CREATE TABLE ROL(
	CODIGO CHAR(1) NOT NULL,
	DESCRIPCION VARCHAR(30),
	CONSTRAINT PK_ROL PRIMARY KEY (CODIGO)
); 

CREATE TABLE EMPLEADO (
	ID VARCHAR (11) NOT NULL,
	NOMBRE VARCHAR(45) NOT NULL,
	MIDDLE_NAME VARCHAR(45),
	APELLIDOS VARCHAR(80) NOT NULL,
	TIPO VARCHAR(10) NOT NULL,
	ACTIVO BOOLEAN NOT NULL,
	CONSTRAINT FK_TIPO FOREIGN KEY (TIPO) REFERENCES ROL(CODIGO) ON DELETE RESTRICT ON UPDATE CASCADE,
	CONSTRAINT PK_EMPLEADO PRIMARY KEY (ID)
);

CREATE TABLE ROL_PERMISOS(
	CODIGO_ROL VARCHAR(10),
	CODIGO_PERMISO VARCHAR(10),
	CONSTRAINT FK_ID_EMPLEADO FOREIGN KEY (CODIGO_ROL) REFERENCES ROL(CODIGO) ON DELETE RESTRICT ON UPDATE CASCADE,
	CONSTRAINT FK_CODIGO_PERMISO FOREIGN KEY (CODIGO_PERMISO) REFERENCES PERMISO(CODIGO) ON DELETE RESTRICT ON UPDATE CASCADE,
	CONSTRAINT PK_ROL_PERMISOS PRIMARY KEY (CODIGO_ROL,CODIGO_PERMISO)
);

CREATE TABLE FACTURA(
	NUMERO VARCHAR(20) NOT NULL,
	MONTO FLOAT NOT NULL,
	FECHA DATE NOT NULL,
	NUMERO_ORDEN VARCHAR(20) NOT NULL UNIQUE,
	CONSTRAINT PK_FACTURA PRIMARY KEY (NUMERO)
);

CREATE TABLE NOTA(
	NUMERO VARCHAR(20) NOT NULL,
	NUMERO_FACTURA VARCHAR(20) NOT NULL,
	MONTO FLOAT NOT NULL,
	FECHA DATE NOT NULL,
	TIPO INT NOT NULL,
	CONSTRAINT FK_NOTA_NUMERO_FACTURA FOREIGN KEY (NUMERO_FACTURA) REFERENCES FACTURA(NUMERO) ON DELETE RESTRICT ON UPDATE CASCADE,
	CONSTRAINT PK_NOTA PRIMARY KEY (NUMERO)
);

CREATE TABLE RUTA(
	NUMERO VARCHAR(10) NOT NULL,
	FECHA DATE NOT NULL,
	EMPLEADO_ID VARCHAR(11),
	INTERNA BOOLEAN NOT NULL,
	CONSTRAINT FK_EMPLEADO_ID FOREIGN KEY (EMPLEADO_ID) REFERENCES EMPLEADO(ID) ON DELETE SET NULL ON UPDATE CASCADE,
	CONSTRAINT PK_RUTA PRIMARY KEY (NUMERO)
);

CREATE TABLE UNIDAD(
	CODIGO VARCHAR(10) NOT NULL,
	NOMBRE VARCHAR(95) NOT NULL,
	ACRON VARCHAR(10) NOT NULL,
	NUMERO_RUTA VARCHAR(10),
	TIPO INT,
	CONSTRAINT FK_UNIDAD_NUMERO_RUTA FOREIGN KEY (NUMERO_RUTA) REFERENCES RUTA(NUMERO) ON DELETE RESTRICT ON UPDATE CASCADE,
	CONSTRAINT PK_UNIDAD PRIMARY KEY (CODIGO)
);

CREATE TABLE EMPLEADO_PERMISOS(
	ID_EMPLEADO VARCHAR(45) NOT NULL,
	CODIGO_PERMISO VARCHAR(10) NOT NULL,
	CONSTRAINT FK_ID_EMPLEADO FOREIGN KEY (ID_EMPLEADO) REFERENCES EMPLEADO(ID) ON DELETE RESTRICT ON UPDATE CASCADE,
	CONSTRAINT FK_CODIGO_PERMISO FOREIGN KEY (CODIGO_PERMISO) REFERENCES PERMISO(CODIGO) ON DELETE RESTRICT ON UPDATE CASCADE,
	CONSTRAINT PK_EMPLEADO_PERMISOS PRIMARY KEY (ID_EMPLEADO,CODIGO_PERMISO)
);

CREATE TABLE GRUPO_ENVIO(
	CODIGO CHAR(3) NOT NULL,
	NOMBRE VARCHAR(15) NOT NULL,
	CONSTRAINT PK_GRUPO_ENVIO PRIMARY KEY (CODIGO)
);

CREATE TABLE PAIS(
	CODIGO VARCHAR(10) NOT NULL,
	NOMBRE VARCHAR(15) NOT NULL,
	CODIGO_GRUPO_ENVIO CHAR(3) NOT NULL,
	CONSTRAINT FK_PAIS_CODIGO_GRUPO_ENVIO FOREIGN KEY (CODIGO_GRUPO_ENVIO) REFERENCES GRUPO_ENVIO(CODIGO) ON DELETE RESTRICT ON UPDATE CASCADE,
	CONSTRAINT PK_PAIS PRIMARY KEY (CODIGO)
);

CREATE TABLE TIPO_ENVIO(
	CODIGO CHAR(2) NOT NULL,
	NOMBRE VARCHAR(50) NOT NULL,
	CONSTRAINT PK_TIPO_ENVIO PRIMARY KEY (CODIGO)	
);

CREATE TABLE TARIFA(
	CODIGO SERIAL NOT NULL,
	PESO_INICIO FLOAT NOT NULL,
	PESO_FINAL FLOAT NOT NULL,
	CODIGO_GRUPO_ENVIO CHAR(3) NOT NULL,
	TIPO CHAR(2) NOT NULL,
	PRECIO FLOAT NOT NULL,
	CONSTRAINT FK_TARIFA_CODIGO_GRUPO_ENVIO FOREIGN KEY (CODIGO_GRUPO_ENVIO) REFERENCES GRUPO_ENVIO(CODIGO) ON DELETE RESTRICT ON UPDATE CASCADE,
	CONSTRAINT FK_TARIFA_TIPO FOREIGN KEY (TIPO) REFERENCES TIPO_ENVIO(CODIGO) ON DELETE RESTRICT ON UPDATE CASCADE,
	CONSTRAINT PK_TARIFA PRIMARY KEY (CODIGO)
);

CREATE TABLE CORRESPONDENCIA_EXTERNA(
	IDENTIFICADOR SERIAL NOT NULL,
	CODIGO VARCHAR(30),
	FECHA DATE NOT NULL,
	PESO FLOAT NOT NULL,
	TIPO CHAR(2) NOT NULL,
	PAIS VARCHAR(10) NOT NULL,
	PRECIO FLOAT NOT NULL,
	DIRECCION VARCHAR(80),
	DESTINATARIO VARCHAR(80),
	REMITENTE VARCHAR(80),
	CANTIDAD INT NOT NULL,
	FACTURA VARCHAR(20),
	UNIDAD VARCHAR(10) NOT NULL,
	CONSTRAINT FK_CORRESPONDENCIA_EXTERNA_TIPO FOREIGN KEY (TIPO) REFERENCES TIPO_ENVIO(CODIGO) ON DELETE RESTRICT ON UPDATE CASCADE,
	CONSTRAINT FK_CORRESPONDENCIA_EXTERNA_CODIGO_PAIS FOREIGN KEY (PAIS) REFERENCES PAIS(CODIGO) ON DELETE RESTRICT ON UPDATE CASCADE,
	CONSTRAINT FK_CORRESPONDENCIA_EXTERNA_NUMERO_FACTURA FOREIGN KEY (FACTURA) REFERENCES FACTURA(NUMERO) ON DELETE RESTRICT ON UPDATE CASCADE,
	CONSTRAINT FK_CORRESPONDENCIA_EXTERNA_CODIGO_UNIDAD FOREIGN KEY (UNIDAD) REFERENCES UNIDAD(CODIGO) ON DELETE RESTRICT ON UPDATE CASCADE,
	CONSTRAINT PK_CORRESPONDENCIA_EXTERNA PRIMARY KEY (IDENTIFICADOR)
);

CREATE TABLE TIPO_INTERNO(
	ACRON CHAR(10) NOT NULL UNIQUE,
	DESCRIPCION VARCHAR(95) NOT NULL UNIQUE,
	CONSTRAINT PK_TIPO_INTERNO PRIMARY KEY (ACRON)
);

CREATE TABLE CORRESPONDENCIA_INTERNA(
	IDENTIFICADOR SERIAL NOT NULL,
	CODIGO VARCHAR(30),
	TIPO CHAR(10) NOT NULL,
	FECHA_ENTREGA_MENSAJERO DATE NOT NULL,
	PROCEDENCIA_UNIDAD VARCHAR(95) NOT NULL,
	DESTINO_UNIDAD VARCHAR(95) NOT NULL,
	FECHA_RECIBIDO DATE,
	NOMBRE_RECIBIDO VARCHAR(50),
	ID_RECIBE_EMPLEADO VARCHAR(11) NOT NULL,
	ID_ENTREGA_EMPLEADO VARCHAR(11),
	DESTINATARIO VARCHAR(80),
	RUTA_ASIGNADA VARCHAR(10),
	CONSTRAINT FK_CORRESPONDENCIA_INTERNA_RUTA_ASIGNADA FOREIGN KEY (RUTA_ASIGNADA) REFERENCES RUTA(NUMERO) ON DELETE SET NULL ON UPDATE CASCADE,
	CONSTRAINT FK_CORRESPONDENCIA_INTERNA_ID_RECIBE_EMPLEADO FOREIGN KEY (ID_RECIBE_EMPLEADO) REFERENCES EMPLEADO(ID) ON DELETE SET NULL ON UPDATE CASCADE,
	CONSTRAINT FK_CORRESPONDENCIA_INTERNA_ID_ENTREGA_EMPLEADO FOREIGN KEY (ID_ENTREGA_EMPLEADO) REFERENCES EMPLEADO(ID) ON DELETE SET NULL ON UPDATE CASCADE,
	CONSTRAINT FK_CORRESPONDENCIA_INTERNA_TIPO_INTERNO FOREIGN KEY (TIPO) REFERENCES TIPO_INTERNO(ACRON) ON DELETE RESTRICT ON UPDATE CASCADE,
	CONSTRAINT PK_CORRESPONDENCIA_INTERNA PRIMARY KEY (IDENTIFICADOR)
);

CREATE TABLE PRESUPUESTO(
	CODIGO VARCHAR(5),
	TITULO VARCHAR(30),
	MONTO FLOAT,
	CONSTRAINT PK_PRESUPUESTO PRIMARY KEY (CODIGO)
);

CREATE TABLE MOVIMIENTO_PRESUPUESTO(
	CODIGO VARCHAR NOT NULL,
	CODIGO_PRESUPUESTO VARCHAR(5) NOT NULL,
	FECHA DATE NOT NULL,
	NUMERO_DEPOSITO VARCHAR,
	NUMERO_CHEQUE VARCHAR,
	IMPORTE FLOAT NOT NULL,
	CONSTRAINT FK_MOVIMIENTO_PRESUPUESTO_CODIGO_PRESUPUESTO FOREIGN KEY (CODIGO_PRESUPUESTO) REFERENCES PRESUPUESTO(CODIGO) ON DELETE RESTRICT ON UPDATE CASCADE,
	CONSTRAINT PK_MOVIMIENTO_PRESUPUESTO PRIMARY KEY (CODIGO)
);

CREATE TABLE ERROR_LOG(
	CODIGO SERIAL NOT NULL,
	ID_EMPLEADO VARCHAR(11),
	DESCRIPCION VARCHAR(2048),
	CONSTRAINT FK_ERROR_LOG_EMPLEADO FOREIGN KEY(ID_EMPLEADO) REFERENCES EMPLEADO(ID) ON DELETE CASCADE ON UPDATE CASCADE,
	CONSTRAINT PK_ERROR_LOG PRIMARY KEY (CODIGO)
);

CREATE TABLE TRANSACTION_LOG(
	CODIGO SERIAL NOT NULL,
	ID_EMPLEADO VARCHAR(11),
	NOMBRE_TABLA VARCHAR(40),
	CONSULTA VARCHAR(2048),
	CONSTRAINT FK_ERROR_LOG_EMPLEADO FOREIGN KEY(ID_EMPLEADO) REFERENCES EMPLEADO(ID) ON DELETE CASCADE ON UPDATE CASCADE,
	CONSTRAINT PK_TRANSACTION_LOG PRIMARY KEY (CODIGO)
);


